## Protocol

The generated protocol code is formed arround a simple set of json messages.
Only one set of plain-text messages will be sent at the start, containing the version string and a "good" or "invalid" response.


### Version verification
The client opens a websocket to server. Server waits for a plain-text message. Client sends the version string (sha256). Server compares the version string and returns "good" or "invalid"

### JSON request/response
The request and response formats are equal for both client->server and server->client.
```json
{
	// type string
    // type of the message
    //      "req": request from one side to the other
    //      "res": response on an earlier send request
    "type": "",

    // procedure string
    // procedure name for the to-be-called procedure
    // exclusively and mandatory for type "req"
    "procedure": "",

    // cb_id number
    // cb_id is a callback generated by side that creates the req
    // cb_id is used to relay any response back to the original request
    // mandatory for types "req" and "res" where the procedure is not a 'oneway' procedure
    "cb_id": 0,

    // data object
    // type "req": parameters for the to-be-called procedure
    // type "res": return values from the called procedure (if it provides return values)
    "data": {},

    // error object
    // when this field is not nil/null/undefined, and error ocurred
    "error": {},
}
```

### Data object

The fields on the data object depend on the arguments or return values for a procedure.
Given this ango definition: `server askQuestion(question string)(answer string)`.

Data structure on `type: "req"`
```json
{
	"question": "What is the answer to life, the universe, and everything?"
}
```

Data structure on `type: "res"`
```json
{
	"answer": "42"
}
```

### Error object
When the error field is not nil/null, an error occurred. The details of this error are recorded in the error object.

In Angular: the error object is given to the reject handler on deferred.

In Go: the error object is returned by the procedure call.

```json
{
	// type string
	// the type string indicates what kind of error happened
	// list of error types defined below
	"type": "",

	// The contents of message depends on the type, specified below
	"message": "",
}
```

#### Error types
 - `unknown`: uknown error (should never happen).
 - `panicOrException`: panic or exception occured in procedure. `message` hold's the panic or exception string.
 - `errorReturned`: the procedure returned an error. `message` hold's the returned error string.
 - .. more...

### Example request/response
Ango definition: `server calculatorAdd(a int, b int)(c int, fortuneCookie string)`

Request json:
```json
{
	"type": "req",
	"procedure": "calculatorAdd",
	"cb_id": 523,
	"data": {
		"a": 42,
		"b": 1337
	}
}
```

Response json:
```json
{
	"type": "res",
	"cb_id": 523,
	"data": {
		"c": 1379,
		"fortuneCookie": "Those who walk in other's tracks leave no footprints."
	}
}
```